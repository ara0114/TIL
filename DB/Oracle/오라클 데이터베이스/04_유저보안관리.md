# 계정과 스키마

- 계정: 오라클의 조작이나 관리 수행. 오브젝트의 소유자 역할.(명시적으로 지정하지 않을 경우 오브젝트 생성한 계정이 소유자)-오브젝트가 해당계정 스키마에 위치
- 스키마: 계정이 소유하는 테이블이나 인덱스 등의 오브젝트를 포함하는 컨테이너(논리적) ≠ 테이블스페이스

 

- 계정정보 백업: 계정 생성시 사용했던 DDL문 백업, DBMS_METADATA패캐지 사용해 DDL문 추출.
(계정 정보 데이터 딕셔너리에 저장되므로 일반 데이터 백업처럼 할 수 없음)

## 계정의 속성

- DEFAULT 테이블 스페이스와 DEFAULT 임시 테이블 스페이스
    - DEFAULT: 오브젝트 생성할때 저장할 테이블 스페이스를 지정하지 않았을때 저장되는 테이블 스페이스. DEFAULT TABLESPACE
    - DEFAULT임시: SQL실행시 임시 세그먼트가 필요할때 임시 세그먼트를 확보하기 위한 테이블 스페이스. TEMPORARY TABLESPACE
    - 둘중하나 지정하지 않으면 데이터베이스에 설정된 기본 테이블 스페이스 지정(데이터베이스에도 설정되어있지않다면 SYSTEM)
- 암호: 오라클 데이터베이스에 의한 인증
- 권한과 롤
    - 권한: 특정한 조작(특정유형의 SQL문을 실행하거나 다른유저의 객체에 액세스)을 수행할 수 있는 권리
    - 롤: 여러개의 권한을 모아둔 것. 유저나 다른 롤에 부여된 관련 권한의 명명된 그룹
- QUOTA
    - 테이블 스페이스의 할당 제한. 유저의 리소스 사용을 제어
    - 테이블 스페이스 안에서 해당 계정이 사용할 수 있는 공간의 상한값
    - 여러계정이 한 테이블 스페이스 함께 사용하는 상황에 특정 계정이 테이블 스페이스 독점해 버리는 상황 막을때 유용
    - SYSTEM 또는 SYSAUX 테이블스페이스 유저에게는 제공X.
- 계정 프로파일
    - 계정이 사용할 수 있는 자원 제한하거나 패스워드 관리 정책 규정하는것
    - 지정하지 않으면 DEFAULT프로파일 설정
    - 리소스 프로파일과 조합하여 정의
    - 리소스 프로파일
        - 계정이 사용할 수 있는 각종 자원에 제한을 거는 방식
        - 계정이 사용할 수 있는 패스워드의 관리 정책을 규정

## 계정의 종류

- 오라클 기본 계정: 오라클에서 만든 주요계정
    - 특수계정:특수한 역할을 가진 계정, 오라클 내부동작과 밀접한 관계를 가진 오브젝트 소유
        - SYS, SYSTEM, DBSNMP, SYSMAN
    - 데모계정: 데모를 위한 오브젝트 소유
        - SCOTT, HR
    - 오라클 이용해 시스템 구축시 기본계정 사용하면 안됌. 새 계정 만들고 사용
- 관리 계정
    - SYS계정: SYSDBA권한이라는 데이터베이스 생성/기동/정지/백업/복구 등을 포함한 데이터베이스의 모든 관리작업 수행할 수 있는 특수 권한을 가진 관리 계정.
        - 인스턴스가 정지돼있을때도 오라클 접속 가능
        - SYS계정은 데이터 딕셔너리뷰(오라클 내부 정보 확인가능), 동적성능뷰, 데이터딕셔너리(데이터딕셔너리뷰의 원본테이블) 소유
        - SELECT/UPDATE/INSERT/DELETE ANY TABLE 시스템권한을 가진 계정이라도 SYS스키마 내 오브젝트에 접근하는것 허용X
    - SYSTEM계정: DBA롤을 가진 관리용 계정.
        - SYSDBA권한이나 SYSOPER권한은 갖고있지 않지만 거의 모든 조작 수행
        - 관리 정보를 저장하기 위한 특별한 테이블, 관리정보를 조회할수있는 특별한 뷰, 각종 데이터베이스 컴포넌트와 도구들이 사용하는 내부적인 테이블과 뷰 소유
        - 애플리케이션에서 사용하는 오브젝트 저장하면 안됌
    - SYSBACKUP, SYSDG, SYSKM: 관리자의 책임을 분리할 목적으로 생성.

## 권한

특정 유형의 SQL문을 실행하거나 다른 유저의 객체에 액세스하는데 필요한 권리

- 최소 권한의 원칙
    - 유저가 작업을 효율적으로 완료하는데 필요한 권한만 유저에게 부여
    - 데이터 딕셔너리 보호(07_DICTIONARY_ACCESSIBILITY=FALSE). ⇒ SYS유저가 SYSDBA로만 로그인할 수 있음
    - PUBLIC에서 불필요한 권한 취소
    - 네트워크 엑세스 제어 ACL사용
    - 유저가 액세스 할 수 있는 디렉토리 제한
    - 관리 권한 갖는 유저 제한
    - 원격 데이터베이스 인증 제한(REMOTE_OS_AUTHENT=FALSE)
    - 불필요한 권한 취소하기위해 사용된 권한 분석함
        - DBMS_PRIVILEGE_CAPTURE패키지 사용.
        - 분석유형/조건 정의 → 사용된 권한 분석 시작/종료 → 보고서 생성 → 미사용 권한 취소
- 오브젝트 권한
    - 특정 오브젝트에 관한 권한. 유저가 특정 객체를 액세스 및 조작할 수 있음.
    - 권한이 없는 유저는 자신이 소유한 객체에만 액세스 할 수 있음.
    - 주요 권한
        - 테이블 - SELECT, UPDATE, INSERT, DELETE, ALTER
        - 뷰 - SELECT, UPDATE, INSERT, DELETE
- 시스템 권한
    - 시스템에 대한 권한. 유저가 데이터베이스에서 특정 작업을 수행할 수 있음.
    - `ANY` : 해당 스키마의 범위를 벗어나 권한 부여할 수 있음. SYS유저와  DBA롤 유저는 모든 ANY권한 가짐.⇒ 모든 데이터 객체에 대해 어떤작업도 수행가능
    - 주요 권한
        - 데이터베이스-ALTER DATEBASE
        - 시스템-ALTER SYSTEM
        - 테이블-CREATE/ALTER/DROP ANY TABLE
        - 인덱스-CREATE/ALTER/DROP ANY INDEX
        - 계정-CREATE/ALTER/DROP USER
    - 특수 시스템 권한
        - SYSDBA, SYSOPER: 데이터베이스의 생성/기동/정지/백업 복구 등을 할 수 있는 데이터 베이스 관리를 위한 강력한 시스템 권한
            - SYSOPER: 기본적 작업 수행. 유저 데이터 볼 수 있는 권한은 X
            - SYSDBA: 불완전 복구 및 데이터베이스 삭제권한 추가부여. SYS유저로 연결할 수 있음.
        - GRANT로 권한 부여한 경우
            - AS SYSDBA나 AS SYSOPER를 지정해 접속하여 권한을 활성화 해야함
            - 권한취소
                - 시스템 권한에 대해 ADMIN OPTION 가진 유저는 REVOKE SQL문을 사용해 권한 취소할 수 있음.(연쇄적 취소X)
                - GRANT OPTION 으로 DML작업과 관련된 시스템권한 취소할 수 있음.(자신이 부여한 권한만 취소할 수 있음, 연쇄적 취소O)

## 롤

여러 권한을 요약한 것. 롤을 계정에 할당시 롤에 포함된 권한이 계정에 부여

- 데이터 딕셔너리에 저장 ⇒ 백업 별도로 수행X
- 롤에 다른 롤을 부여하는 형태로 권한 계층적 관리가능
- 장점
    - 권한 관리 용이성: 권한 관리 단순화. 동일한 권한 부여 후 권한에 롤을 부여하여 각각의 롤을 유저에게 부여 할 수 있음.
    - 동적 권한 관리: 개별 업무 및 역할과 관련된 권한 수정시 그 롤을 부여받은 모든 유저 자동으로 즉시 수정된 권한 얻음.
    - 권한 선택의 가용성: 롤을 활성화 및 비활성화하여 일시적으로 권한 설정 및 해제 가능(특정 상황에서 유저 권한 제어가능)
- 특성
    - 롤에 권한을 부여하고 취소할 수 있음
    - 롤을 유저나 다른 롤에 부여하거나 취소할 수 있음
    - 시스템 및 객체 권한으로 구성될 수 있음
    - 롤을 부여받은 각 유저에 대해 활성화 및 비활성화 될 수 있음
    - 활성화하려면 암호 필요함
    - 유저가 소유하지않으며 스키마에 존재하지 않음.(데이터 딕셔너리에 저장)
- 미리 정의 된 롤 - 포함하는 권한
    - CONNECT - CREATE SESSION
    - DBA - 대부분의 시스템권한 및 기타 여러가지롤
    - RESOURCE - CREATE CLUSTER/INDEXTYPE/OPERATOR/PROCEDURE/SEQUENCE/TABLE/TRIGGER/TYPE
    - SCHEDULER_ADMIN - CREATE ANY JOB, CREATE EXTERNAL JOB, CREATE JOB, EXECUTE ANY CLASS, EXECUTE ANY PROGRAM, MANAGE SCHEDULER
    - SELECT_CATALOG_ROLE - 데이터 딕셔너리 객체에 대한 SELECT

## 확인방법

- DBA_USERS뷰: 계정명, 상태, 기본 테이블 스페이스 같은 오라클 계정 관련정보
- DBA_TS_QUOTAS뷰: QUOTA정보
- DBA_PROFILES뷰: 데이터베이스 전체 계정 프로파일 정보
- DBA_TAB_PRIVS뷰: 데이터베이스상에서 할당된 모든 오브젝트 권한
- DBA_SYS_PRIVS뷰: 데이터베이스에 있는 모든 시스템 권한
- USER_SYS_PRIVS뷰: 계정에 직접 할당된 시스템 권한
- SESSION_PRIVS뷰: 계정에 할당된 모든 시스템 권한(직접/간접)
- DBA_ROLES뷰: 데이터베이스에 존재하는 롤의 정보
- DBA_ROLE_PRIVS뷰: 계정 또는 롤에 부여된 롤
- USER_ROLE_PRIVS뷰: 현재 계정에 직접 부여된 롤(롤을 통해 간접적으로 부여된 롤은 확인X)
- SESSION_ROLES뷰: 현재 계정에 부여된 모든 롤
