# 빈 생명주기 콜백

- 애플리케이션 시작 시점에 필요한 연결 미리 해두고 종료 시점에 연결을 모두 종료하는 작업을 진행하려면, 객체의 초기화와 종료작업 필요
- 스프링 빈의  간단한 라이플 사이클
  - 객체생성 -> 의존관계 주입

- 스프링 빈은 객체 생성 후, 의존관계 주입이 다 끝난 다음 준비 완료 => 초기화 작업은 의존관계 주입 모두 완료된 후 호출해야 함

- 스프링은 의존관계 주입 완료되면 스프링 빈에 콜백 메소드 통해 초기화 시점 알려주는 다양한 기능 제공
- 스프링은 스프링 컨테이너가 종료되기 직전 소멸 콜백을 줌

- **스프링 빈의 이벤트 라이프사이클**

```
스프링 컨테이너 생성 -> 스프링 빈 생성 -> 의존관계 주입 -> 초기화 콜백 -> 사용 -> 소멸 전 콜백 -> 스프링 종료

- 초기화 콜백: 빈 생성 및 의존관계 주입 완료된 후 호출
- 소멸 전 콜백: 빈 소멸되기 직전 호출
```

- 객체의 생성과 초기화 분리하기

  - 생성자는 필수정보를 받고 메모리 할당해 객체를 생성하고, 초기화는 생성된 값들 활용해 외부 커넥션 연결등 무거운 동작 수행

  - 객체 생성부분과 초기화 분리하는것이 유지보수 관점에서 좋음.

    (초기화 작업이 내부값들만 약간 변경하는 정도로 단순한 경우 생성자에서 한번에 다 처리하는게 나을 수도 있음)

## 스프링의 빈 생명주기 콜백 지원 방법

### 인터페이스(InitializingBean, DisposableBean)

- InitializingBean의 afterPropertiesSet() 메소드로 초기화를 지원(afterPropertiesSet: 의존관계 주입끝나면 호출하겠다)
- DisposableBean의 destroy() 메소드로 소멸을 지원
- **스프링 전용 인터페이스에 의존**
- 초기화,소멸 메소드의 이름 변경 불가
- 내가 고칠수 없는 외부 라이브러리에 적용불가
- 스프링 초창기에 나온 방법으로, 지금은 *거의 사용하지 않음*

### 설정정보에 빈 등록 초기화 메소드, 종료 메소드 지정

- @Bean(initMethod = "초기화메소드이름", destroyMethod = "종료메소드이름") 처름 초기화, 종료메소드 지정
- 메소드 이름 자유롭게 사용 가능
- 스프링 빈이 스프링 코드에 의존하지 않음
- 코드가 아니라 설정정보 사용하므로 **코드 고칠 수 없는 외부 라이브러리에도 초기화, 종료 메소드 적용할 수 있음**
- 종료메소드 추론:  `close`, `shutdown` 이름의 메소드 자동 호출.(종료 메소드 추론해 호출)
  - 라이브러리 대부분 close, shutdown 이라는 이름의 종료 메소드 사용
  - @Bean의 destroyMethod 기본값이 (inferred) (추론)으로 등록되어 있음
  - 직접 스프링 빈으로 등록하면 종료 메소드 따로 적어주지 않아도 잘 동작함
  - 사용하기 싫다면 `destroyMethod=""` 처럼 빈 공백 지정

### @PostConstruct, @PreDestroy 어노테이션 지원✔

- 어노테이션만 붙이면 되므로 편리하고, 최신 스프링에서 **가장 권장하는 방법**
- javax.annotation.~ 패키지로 스프링에 종속적이지 않고 **자바표준**임. => 스프링 아닌 다른 컨테이너에서도 동작
- 컴포넌트 스캔과 잘 어울림
- 외부 라이브러리에는 적용하지 못한다는 것이 유일한 단점

- **`@PostConstruct`, `@PreDestroy` 사용하고, 코드 고칠 수 없는 외부 라이브러리 초기화, 종료해야 할 경우 `initMethod`, `destroyMethod`사용하기**

