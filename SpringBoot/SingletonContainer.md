## 웹 애플리케이션&싱글톤

- 대부분의 스프링 애플리케이션 = 웹 애플리케이션
- 웹 애플리케이션: 보통 여러고객이 동시에 요청

스프링 없는 AppConfig: 요청 할때마다 객체 새로 생성, 메모리 낭비 심함

=> 객체가 딱 1개만 생성되고 공유하여 해결(**싱글톤 패턴**)

## 싱글톤 패턴

- 클래스의 인스턴스가 딱 1개만 생성되는 것을 보장하는 디자인 패턴
- 객체 인스턴스 2개이상 생성하지 못하게 막아야 함

여러 방법중 **객체 미리 생성해두는 가장 단순하고 안전한 방법**을 사용한 예

1. static 영역에 객체 1개만 생성
2. 인스턴스가 필요하면 getInstance를 통해 조회 (=>항상 같은 인스턴스 반환)
3. 생성자 private로 선언해서 외부에서의 new 객체 생성 막음

<br>

싱글톤 패턴을 적용하면 요청이 올 때마다 객체를 생성하지 않고, 이미 만들어진 객체를 공유해서 효율적으로 사용할 수 있음 

<br>

**싱글톤 패턴 문제점** => 스프링 컨테이너가 모두 해결해준다!.

1. 싱글톤 **패턴을 구현하는 코드** 자체가 **많이** 들어감
2. 클라이언트가 구체 클래스에 의존 => **DIP를 위반** (ex. 구체클래스.getInstance() )
3. 클라이언트가 구체 클래스에 의존하여 **OCP원칙을 위반할 가능성 높음**
4. 테스트하기 어려움(유연성X)
5. 내부속성 변경이나 초기화가 어려움
6. private생성자를 사용하여 자식클래스 만들기 어려움
7. **유연성이 떨어짐**
8. 안티패턴으로도 불림

## 싱글톤 컨테이너

- 스프링 컨테이너 : 싱글톤 패턴을 적용하지 않아도 객체 인스턴스를 싱글톤으로 유지관리

  (스프링 빈 = 싱글톤으로 관리되는 빈)

- 스프링 컨테이너 = 싱글톤 컨테이너역할 

  => `싱글톤 레지스트리` : 싱글톤 객체를 생성하고 관리하는 기능

  => 싱글톤 패턴의 모든 단점 해결, 객체를 싱글톤으로 유지

  	- 싱글톤 패턴을 위한 코드 X
  	- DIP, OCP, 테스트, private생성자로부터 자유롭게 싱글톤 사용가능

<br>

스프링 컨테이너 덕분에 요청이 올 때마다 객체를 생성하지 않고, 이미 만들어진 객체를 공유해서 효율적으로 재사용할 수 있음.

<br>

스프링은 99% **싱글톤 빈**, *but* 요청할때마다 새로운 객체를 생성해서 반환하는 기능도 제공(빈스코프) 

## 싱글톤 방식의 주의점

- 여러 클라이언트가 하나의 같은 객체 인스턴스를 공유함

  => 상태를 유지하지 않도록 **무상태(stateless)로 설계** 해야함

  - 특정 클라이언트에 의존적인 필드 있으면 안됌
  - 특정 클라이언트가 값을 변경할 수 있는 필드가 있으면 안됌
  - 가급적 읽기만 가능하도록
  - 필드 대신 **공유되지 않는** *지역변수, 파라미터, ThreadLocal* 등을 사용해야함

- **공유필드 주의** 

- **스프링빈은 항상 무상태로 설계할 것** 
